Metadata-Version: 2.4
Name: esop-management-tool
Version: 0.1.0
Summary: Production-ready ESOP management tool with FastAPI and SQLite
Requires-Python: >=3.10
Description-Content-Type: text/markdown
Requires-Dist: fastapi<1.0.0,>=0.115.0
Requires-Dist: uvicorn[standard]<1.0.0,>=0.30.0
Requires-Dist: sqlalchemy<3.0.0,>=2.0.30
Requires-Dist: pydantic<3.0.0,>=2.8.0
Requires-Dist: authlib<2.0.0,>=1.3.1
Provides-Extra: dev
Requires-Dist: pytest<9.0.0,>=8.2.0; extra == "dev"
Requires-Dist: httpx<1.0.0,>=0.27.0; extra == "dev"
Requires-Dist: anyio<5.0.0,>=4.4.0; extra == "dev"

# ESOP Management Tool

Production-ready ESOP management web app for internal company use, built with **FastAPI + SQLite**.

## What it supports

- Google SSO login (OIDC) for organization users
- Role-based access:
  - `admin`: manage employees, grants, exercises
  - `employee`: read-only access to own ESOP data
- Employee management (create, list, update, deactivate)
- Grant management (create, list, update)
- Vesting computation with cliff + periodic vesting
- Exercise recording with validation against vested quantity
- Dashboard metrics for pool allocation and vesting status
- Browser UI at `/` and API docs at `/docs`

## Tech stack

- FastAPI (API + web serving)
- SQLAlchemy 2.0 ORM
- SQLite database
- Vanilla JS frontend
- Pytest test suite

## Quick start (local)

1. Create a virtual environment and install dependencies:

```bash
python -m venv .venv
source .venv/bin/activate
pip install -e .[dev]
```

2. Configure environment:

```bash
cp .env.example .env
```

Set these required auth fields in `.env`:

- `SESSION_SECRET_KEY` to a long random string
- `GOOGLE_CLIENT_ID`
- `GOOGLE_CLIENT_SECRET`
- `GOOGLE_ORG_DOMAIN` (e.g. `yourcompany.com`)
- `ADMIN_EMAILS` (comma-separated admin users)

Google OAuth redirect URI:

- `http://127.0.0.1:8000/api/auth/callback` (local)
- `https://<your-domain>/api/auth/callback` (production)

3. Run the server:

```bash
uvicorn app.main:app --reload
```

4. Open:

- UI: http://127.0.0.1:8000/
- API docs: http://127.0.0.1:8000/docs

Database file (`esop.db`) is created automatically on startup.

If you run the app from another working directory, the SQLite path is still resolved against this project root to avoid read-only DB path issues.

## Run tests

```bash
pytest
```

## API overview

- `GET /health`
- `GET /api/auth/login`
- `GET /api/auth/callback`
- `GET /api/auth/me`
- `POST /api/auth/logout`
- `POST /api/employees`
- `GET /api/employees`
- `PATCH /api/employees/{employee_id}`
- `DELETE /api/employees/{employee_id}`
- `POST /api/grants`
- `GET /api/grants`
- `PATCH /api/grants/{grant_id}`
- `POST /api/grants/{grant_id}/exercises`
- `GET /api/grants/{grant_id}/summary`
- `GET /api/dashboard/summary`

## Production notes

- Set `ENVIRONMENT=production` and `DEBUG=false`.
- Set `SESSION_COOKIE_SECURE=true` behind HTTPS.
- Restrict CORS with `CORS_ORIGINS` (comma-separated origins).
- Use regular DB backups of `esop.db`.
- Run behind a reverse proxy/load balancer in production.
- Keep `AUTH_ENABLED=true` in production.
- Keep at least one email in `ADMIN_EMAILS` to avoid admin lockout.
- Admin self-protection rules:
  - Admins cannot create their own employee profile.
  - Admins cannot assign/update grants for their own employee record.
  - Another admin must perform those operations.

## Troubleshooting

- `sqlite3.OperationalError: attempt to write a readonly database`
  - Ensure the process user has write permission to this project folder (or set `DATABASE_URL` to an absolute writable path like `sqlite:////tmp/esop.db`).

## Docker

Build and run:

```bash
docker build -t esop-tool .
docker run --rm -p 8000:8000 -v "$(pwd)":/app esop-tool
```
